{% assign video_data = include.video %}
{% assign platform = video_data.platform | default: 'youtube' %}
{% assign embed_url = nil %}
{% if platform == 'youtube' %}
  {% if video_data.embed_url %}
    {% assign embed_url = video_data.embed_url %}
  {% elsif video_data.youtube_id %}
    {% assign embed_url = 'https://www.youtube.com/embed/' | append: video_data.youtube_id %}
    {% if video_data.youtube_query %}
      {% assign embed_url = embed_url | append: '?' | append: video_data.youtube_query %}
    {% endif %}
  {% endif %}
{% elsif platform == 'instagram' %}
  {% if video_data.instagram_embed_url %}
    {% assign embed_url = video_data.instagram_embed_url %}
  {% elsif video_data.instagram_shortcode %}
    {% assign embed_url = 'https://www.instagram.com/reel/' | append: video_data.instagram_shortcode | append: '/embed?hidecaption=true' %}
  {% elsif video_data.instagram_permalink %}
    {% assign permalink = video_data.instagram_permalink | split: '?' | first %}
    {% assign segments = permalink | split: '/' %}
    {% assign instagram_shortcode = '' %}
    {% for segment in segments %}
      {% assign trimmed = segment | strip %}
      {% if trimmed != '' and trimmed != 'reel' and trimmed != 'reels' and trimmed != 'p' %}
        {% assign instagram_shortcode = trimmed %}
      {% endif %}
    {% endfor %}
    {% if instagram_shortcode != '' %}
      {% assign embed_url = 'https://www.instagram.com/reel/' | append: instagram_shortcode | append: '/embed?hidecaption=true' %}
    {% endif %}
  {% endif %}
{% endif %}

{% capture role_classes %}
  {% for role in video_data.roles %}
    {{- role | strip | slugify: 'raw' -}}{% unless forloop.last %} {% endunless %}
  {% endfor %}
{% endcapture %}
{% assign role_classes = role_classes | strip %}

{% assign roles_display = '' %}
{% for role in video_data.roles %}
  {% assign role_label = role | strip | capitalize %}
  {% if forloop.first %}
    {% assign roles_display = role_label %}
  {% else %}
    {% assign roles_display = roles_display | append: ', ' | append: role_label %}
  {% endif %}
{% endfor %}

<div class="col-md-4 mb-4 video-card{% if role_classes != '' %} {{ role_classes }}{% endif %}">
  <div class="embed-responsive embed-responsive-16by9">
    {% if embed_url %}
      <iframe class="embed-responsive-item" src="{{ embed_url }}" title="{{ video_data.title | escape }}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading="lazy"></iframe>
    {% endif %}
  </div>
  <div class="video-info mt-2 text-center">
    <h5 class="montserrat-400">{{ video_data.title }}</h5>
    {% if roles_display != '' %}
      <p>{{ roles_display }}</p>
    {% endif %}
  </div>
</div>