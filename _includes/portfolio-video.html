{% assign video_data = include.video %}
{% assign platform = video_data.platform | default: 'youtube' %}
{% assign embed_url = nil %}
{% if platform == 'youtube' %}
  {% if video_data.embed_url %}
    {% assign embed_url = video_data.embed_url %}
  {% elsif video_data.youtube_id %}
    {% assign embed_url = 'https://www.youtube.com/embed/' | append: video_data.youtube_id %}
    {% if video_data.youtube_query %}
      {% assign embed_url = embed_url | append: '?' | append: video_data.youtube_query %}
    {% endif %}
  {% endif %}
{% endif %}

{% capture role_classes %}
  {% for role in video_data.roles %}
    {{- role | strip | slugify: 'raw' -}}{% unless forloop.last %} {% endunless %}
  {% endfor %}
{% endcapture %}
{% assign role_classes = role_classes | strip %}

{% assign roles_display = '' %}
{% for role in video_data.roles %}
  {% assign role_label = role | strip | capitalize %}
  {% if forloop.first %}
    {% assign roles_display = role_label %}
  {% else %}
    {% assign roles_display = roles_display | append: ', ' | append: role_label %}
  {% endif %}
{% endfor %}

<div class="col-md-4 mb-4 video-card{% if role_classes != '' %} {{ role_classes }}{% endif %}">
  {% if platform == 'instagram' %}
    {% assign permalink = video_data.instagram_permalink %}
    {% assign captioned = video_data.instagram_captioned | default: false %}
    <div class="instagram-embed-wrapper">
      {% if permalink %}
        <blockquote class="instagram-media" data-instgrm-permalink="{{ permalink | escape }}" data-instgrm-version="14"{% if captioned %} data-instgrm-captioned="true"{% endif %}>
          <a href="{{ permalink | escape }}" target="_blank" rel="noopener">{{ video_data.instagram_cta | default: 'View this post on Instagram' }}</a>
        </blockquote>
      {% endif %}
    </div>
  {% else %}
    <div class="embed-responsive embed-responsive-16by9">
      {% if embed_url %}
        <iframe class="embed-responsive-item" src="{{ embed_url }}" title="{{ video_data.title | escape }}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading="lazy"></iframe>
      {% endif %}
    </div>
  {% endif %}
  <div class="video-info mt-2 text-center">
    <h5 class="montserrat-400">{{ video_data.title }}</h5>
    {% if roles_display != '' %}
      <p>{{ roles_display }}</p>
    {% endif %}
  </div>
</div>